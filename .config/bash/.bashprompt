#!/usr/bin/env bash

# Configure colors
CYAN="\[\033[0;36m\]"
LIGHT_GRAY="\[\033[0;37m\]"
GREEN="\[\033[0;32m\]"
MAGENTA="\[\033[0;35m\]"
YELLOW="\[\033[0;33m\]"
NO_COLOR="\[\033[0m\]"

# Find and source prompt enhancer shipped with git
enable_git_prompt(){
  GIT_PROMPT=""

  if [ -f ~/.git-prompt.sh ]; then
    source ~/.git-prompt.sh
  fi
}

set_git_prompt(){
  if type -t __git_ps1 | grep -q "function"; then
    GIT_PROMPT="$(__git_ps1 "$MAGENTA(%s)")"
  fi
}

set_python_virtualenv() {
  PYTHON_VENV=""
  if [ ! -z "$VIRTUAL_ENV" ]; then
    PYTHON_VENV="${YELLOW}(`basename \"$VIRTUAL_ENV\"`)${NO_COLOR}"
  fi
}
#
# Configure properies for prompt
# This is called every time before PS1 gets evaluated
setup_prompt() {
  # unstaged (*) and staged (+)
  GIT_PS1_SHOWDIRTYSTATE=true
  # something is stashed ($)
  GIT_PS1_SHOWSTASHSTATE=true
  # untracked (%)
  GIT_PS1_SHOWUNTRACKEDFILES=true
  # behind (<), ahead (>), diverged (<>), same (=)
  GIT_PS1_SHOWUPSTREAM="auto verbose"

  set_git_prompt
  set_python_virtualenv
  PS1="${PYTHON_VENV}$CYAN\u$LIGHT_GRAY@$GREEN\h${GIT_PROMPT} $LIGHT_GRAY\w$YELLOW\$$NO_COLOR "
}

enable_git_prompt
PROMPT_COMMAND=setup_prompt
